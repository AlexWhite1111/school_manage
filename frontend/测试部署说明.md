# 自然教育应用 - 测试部署说明

## 📋 当前配置状态

### 🧪 测试环境配置
```
前端开发服务器: http://localhost:5173
后端API服务器: http://localhost:3000/api  
数据库: 本地PostgreSQL (localhost:5432)
```

### 🎯 应用平台支持
- ✅ Android APK (已配置)
- ✅ Windows桌面应用 (已配置) 
- ✅ Web网页版 (默认支持)

## 🔧 配置文件说明

### 1. API配置文件
**位置**: `src/config/api.ts` (需要创建)

#### 测试环境配置:
```typescript
// 本地测试配置
export const API_BASE_URL = 'http://localhost:3000/api';

export const APP_CONFIG = {
  name: '自然教育',
  version: '1.0.0', 
  apiBaseUrl: API_BASE_URL,
  timeout: 10000
};
```

#### 生产环境配置:
```typescript
// 服务器生产配置
export const API_BASE_URL = 'http://154.194.250.93:3000/api';

export const APP_CONFIG = {
  name: '自然教育',
  version: '1.0.0',
  apiBaseUrl: API_BASE_URL,
  timeout: 10000
};
```

### 2. Capacitor配置
**位置**: `capacitor.config.ts`

当前配置:
```typescript
{
  appId: 'com.alex.naturaleducation',
  appName: '自然教育',
  webDir: 'dist',
  server: {
    // 测试时指向本地
    url: 'http://localhost:5173',
    cleartext: true
  }
}
```

生产配置:
```typescript
{
  appId: 'com.alex.naturaleducation', 
  appName: '自然教育',
  webDir: 'dist',
  // 生产时移除server配置，使用打包后的静态文件
}
```

## 🧪 测试流程

### 阶段1: 本地功能测试
1. **启动后端服务**
   ```bash
   cd backend
   npm run dev
   ```

2. **启动前端开发服务器**
   ```bash
   cd frontend  
   npm run dev
   ```

3. **功能验证清单**
   - [ ] 用户登录/注册
   - [ ] CRM客户管理
   - [ ] 学生日志系统
   - [ ] 财务管理
   - [ ] 数据分析
   - [ ] 成长跟踪
   - [ ] 考试管理
   - [ ] 报表生成

### 阶段2: 应用构建测试
1. **构建前端**
   ```bash
   npm run build
   ```

2. **同步到Capacitor**
   ```bash
   npx cap sync
   ```

3. **桌面应用测试**
   ```bash
   npx cap open @capacitor-community/electron
   # 在Electron窗口中测试应用
   ```

4. **Android应用测试** (需要Android Studio)
   ```bash
   npx cap open android
   # 在Android Studio中运行虚拟机测试
   ```

## 🚀 切换到生产环境

### 第1步: 修改API配置
```bash
# 编辑 src/config/api.ts
# 将 localhost:3000 改为 154.194.250.93:3000
```

### 第2步: 更新Capacitor配置
```bash
# 编辑 capacitor.config.ts
# 移除server配置项
```

### 第3步: 重新构建
```bash
npm run build
npx cap sync
```

### 第4步: 打包应用
```bash
# Android APK
npx cap open android
# 在Android Studio中: Build > Build APK

# Windows安装包
npx cap open @capacitor-community/electron  
# 在Electron项目中: npm run electron:pack
```

## 📱 最终交付文件

### Android
- `android/app/build/outputs/apk/debug/app-debug.apk` (测试版)
- `android/app/build/outputs/apk/release/app-release.apk` (发布版)

### Windows
- `electron/dist/自然教育 Setup 1.0.0.exe` (安装包)
- `electron/dist/win-unpacked/` (免安装版)

### Web版
- `dist/` 目录 (可部署到任何Web服务器)

## ⚠️ 注意事项

### 测试阶段
- 使用本地数据库，数据不会丢失
- 可以随时重置和清理数据
- 前后端代码修改立即生效

### 生产部署前检查
- [ ] 确认服务器后端正常运行
- [ ] 确认服务器CORS配置正确
- [ ] 测试网络连接稳定性
- [ ] 验证数据库连接
- [ ] 确认所有功能在应用中正常

### 数据备份
```bash
# 本地数据库备份
pg_dump -h localhost -U postgres education_crm_dev > backup_test.sql

# 服务器数据库恢复 (如需要)
psql -h 154.194.250.93 -U postgres education_crm < backup_test.sql
```

## 🔄 快速切换脚本

### 切换到测试环境
```bash
# switch-to-test.ps1
$apiFile = "src/config/api.ts"
(Get-Content $apiFile) -replace "154.194.250.93:3000", "localhost:3000" | Set-Content $apiFile
Write-Host "已切换到测试环境 ✅"
```

### 切换到生产环境  
```bash
# switch-to-production.ps1
$apiFile = "src/config/api.ts"
(Get-Content $apiFile) -replace "localhost:3000", "154.194.250.93:3000" | Set-Content $apiFile
Write-Host "已切换到生产环境 🚀"
```

---

**当前状态**: 🧪 测试环境 (本地后端)
**下一步**: 完成本地功能测试 → 构建应用 → 切换生产环境 → 最终部署