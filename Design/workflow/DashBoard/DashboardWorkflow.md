# 核心仪表盘 (Main Dashboard) 与全局功能详细交互流程

本文档详细描述了应用首页——"核心仪表盘"的页面元素与交互，并定义了全局性的"数据导出"功能。

## 1. Feature 4.1: 核心仪表盘 (Main Dashboard)

这是用户登录后看到的第一个页面，旨在提供最重要信息的概览和快速入口。

### 1.1 页面核心元素

页面由多个信息卡片组成，所有数据均通过 **调用 `GET /dashboard/summary` API** 一次性获取。

*   **卡片一：财务速览 (Financial Overview)**
    *   **标题:** `财务速览`
    *   **内容:** 以醒目的数字展示核心财务指标，数据来源于 `GET /dashboard/summary` API的返回结果：
        *   `本月实收`: 从本月第一天至今，所有"收款记录"的金额总和
        *   `本月应收`: 所有"结账日期"在本月内的"收费订单"的应收总额之和
        *   `当前待收总额`: 所有订单的"剩余未付金额"的总和
    *   **交互:** 点击卡片标题或整个卡片区域，会跳转至 **"极简财务中心"** 模块主页 (`/finance`)。
    *   **视觉设计:** 使用图标和颜色区分不同指标，金额以大字体突出显示

*   **卡片二：待办提醒 (Follow-up Reminders)**
    *   **标题:** `今日需跟进的客户`
    *   **内容:** 显示一个可滚动的客户列表。
        *   **数据来源:** `GET /dashboard/summary` API的返回结果中包含的待办提醒列表（所有"下次跟进日期"为今天的客户）。
        *   **列表项:** 每行显示客户姓名、简要信息（如来源渠道）和客户状态标签。
    *   **交互:** 点击列表中的任意一个客户姓名，会直接跳转至该客户的 **"客户档案(Lead Profile)"** 页面 (`/customers/:id`)，方便立即跟进。
    *   **边缘情况 (无待办):** 如果今天没有需要跟进的客户，卡片会显示一个友好提示，例如："今日无待办事项，保持好状态！"
    *   **视觉设计:** 客户状态用不同颜色的标签区分，列表支持滚动查看更多

### 1.2 页面操作与导航

*   **页面头部导航:**
    *   包含系统logo和当前用户信息
    *   右上角提供手动刷新按钮，点击后重新调用 `GET /dashboard/summary` API
    *   用户头像下拉菜单包含"个人设置"和"登出"选项

*   **快速导航卡片:**
    *   在主要信息卡片下方，提供各模块的快速入口
    *   包含"客户管理"、"学生日志"、"财务中心"、"数据导出"等快捷按钮

### 1.3 加载与刷新

*   **用户行为:** 用户访问首页 (`/dashboard`)。
*   **系统反馈:**
    *   页面加载时，所有卡片显示骨架屏或加载动画
    *   **API调用:** 自动调用 `GET /dashboard/summary` API获取仪表盘数据
    *   数据加载完成后，显示实时计算的最新数据
    *   **错误处理:** 如果API调用失败，显示错误提示并提供重试按钮
    *   页面右上角提供手动刷新按钮，用于重新获取最新数据

*   **性能优化:**
    *   仪表盘数据可设置5分钟缓存，避免频繁刷新时重复请求
    *   使用WebSocket或定时器实现关键数据的自动更新

## 2. Feature 4.2: 数据导出 (Data Export)

数据导出功能被设计为在各模块列表页提供入口，同时也可以考虑在"设置"页面或仪表盘上提供一个集中的数据导出中心。

### 2.1 导出交互流程 (通用)

*   **用户行为:** 用户在某个模块的列表页（如客户看板、财务中心等）点击 **"导出CSV"** 按钮。
*   **系统反馈:**
    1.  按钮点击后，立即显示加载状态，提示"正在生成报表..."，按钮变为禁用状态
    2.  系统在后端调用对应的导出API，并附带当前视图的筛选参数：
        *   例如，在CRM"潜在客户"视图下导出，则API调用会附带 `status=POTENTIAL` 参数
        *   在"总客户"视图下导出，则不附带状态筛选参数
    3.  **API响应处理:**
        *   成功时：浏览器自动触发CSV文件下载，文件名包含导出时间戳
        *   失败时：显示具体错误信息，如"网络错误，请稍后重试"
    4.  导出完成后，按钮恢复可用状态，显示"导出完成"提示3秒后消失
    
*   **导出范围与对应API:**
    *   **客户信息 (CRM):** **调用 `GET /export/customers` API**。可附带 `status`, `search` 等查询参数，导出客户档案中的所有基础信息、家长信息、沟通记录和关联标签
    *   **学生成长记录 (Student Log):** **调用 `GET /export/growth-logs` API**。可附带 `studentId`, `classId`, `startDate`, `endDate` 等参数筛选，导出每一次标签记录，包含学生信息、标签内容和精确到秒的记录时间
    *   **财务数据 (Finance):** **调用 `GET /export/finance` API**。可附带 `startDate`, `endDate` 等参数筛选，导出所有订单信息（应收、课程周期等）及关联的收款记录（收款日期、金额、备注）

### 2.2 各模块的导出入口 (具体实现)

*   **客户看板:** 在"总客户"或各阶段客户列表的顶部工具栏，提供"导出CSV"按钮
    *   按钮位置：搜索框右侧，创建客户按钮左侧
    *   导出内容：当前筛选条件下的所有客户信息
    
*   **学生成长日志:** 在"数据追踪报告"的学生列表页顶部，提供"导出成长记录 (CSV)"按钮
    *   按钮位置：页面标题右侧
    *   导出内容：所有学生的成长记录，包含时间范围筛选选项
    
*   **财务中心:** 在"订单管理"的学生财务列表页顶部，提供"导出财务数据 (CSV)"按钮
    *   按钮位置：页面标题右侧，新建订单按钮左侧
    *   导出内容：所有学生的财务订单和收款记录

### 2.3 导出进度与用户体验优化

*   **大数据量处理:**
    *   如果数据量超过1000条，显示进度条和预估完成时间
    *   提供"后台导出"选项，完成后通过通知或邮件告知用户

*   **文件格式与内容:**
    *   CSV文件使用UTF-8编码，确保中文正确显示
    *   包含明确的列标题和数据说明
    *   文件名格式：`模块名_导出时间_筛选条件.csv`

*   **权限控制:**
    *   只有具备相应权限的用户才能执行导出操作
    *   导出操作会记录在系统日志中，便于审计 