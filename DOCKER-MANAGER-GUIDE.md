# 🐳 Docker管理器使用指南

## 📖 概述

`docker-manager.bat` 是教育CRM系统的综合管理工具，提供完整的Docker环境管理、数据库操作和系统维护功能。

## 🚀 快速开始

### 启动管理器
```bash
# Windows双击运行或命令行执行
docker-manager.bat
```

## 📋 功能详解

### 🏗️ 系统管理 (选项1-5)

#### [1] 🚀 完整部署 (新系统)
- **用途**: 全新系统初始化部署
- **包含**: 
  - 环境检查
  - Docker服务构建启动
  - 数据库迁移
  - 基础配置导入
  - 管理员账户创建
- **适用**: 新电脑首次部署

#### [2] 📊 查看服务状态
- **功能**: 显示所有Docker容器状态
- **信息**: 容器名称、状态、端口映射
- **用途**: 快速检查系统运行状态

#### [3] 🔄 重启所有服务
- **操作**: 重启database、backend、frontend
- **场景**: 服务异常时恢复正常

#### [4] 🛑 停止所有服务
- **操作**: 停止所有Docker容器
- **保留**: 数据卷和配置文件

#### [5] 🗑️ 完全清理 (删除所有数据)
- **警告**: ⚠️ 危险操作！
- **清理**: 容器、网络、数据卷、镜像
- **用途**: 完全重置系统

### 💾 数据库管理 (选项6-8)

#### [6] 🔄 重置数据库结构
- **操作**: 强制重置数据库schema
- **效果**: 清空所有数据，重建表结构
- **适用**: 数据结构升级

#### [7] 📥 运行数据库迁移
- **功能**: 应用数据库迁移文件
- **安全**: 不会丢失现有数据
- **推荐**: 优先选择此选项

#### [8] 🎛️ 打开数据库管理界面
- **工具**: Prisma Studio
- **访问**: http://localhost:5555
- **功能**: 可视化数据库操作

### 🌱 数据初始化 (选项9-12)

#### [9] 👤 仅导入管理员账户
- **创建**: admin用户
- **密码**: 123456
- **权限**: SUPER_ADMIN

#### [10] 🏷️ 仅导入标签配置
- **内容**: 
  - 家庭背景标签
  - 学生特征标签
  - 成长评价标签
- **类型**: 预定义标签系统

#### [11] 🧠 仅导入Growth配置
- **配置**: 卡尔曼滤波器参数
- **包含**:
  - 默认配置 (激活)
  - 中学配置
  - 高中配置

#### [12] 🎭 导入演示数据 (包含测试学生)
- **内容**: 
  - 测试客户数据
  - 示例学生信息
  - 班级和课程
  - 成长记录样例
- **用途**: 系统演示和测试

### 🧹 数据清理 (选项13-16)

#### [13] 👥 清除所有客户数据
- **清理表**: customers, customer_tags, communication_logs
- **保留**: 标签配置、用户账户

#### [14] 📚 清除所有学生数据  
- **清理表**: classes, enrollments, attendance_records, growth_logs
- **影响**: 学生相关的所有记录

#### [15] 📝 清除所有成长日志
- **清理表**: growth_logs, growth_states
- **保留**: 学生基础信息

#### [16] 📊 清除所有考试数据
- **清理表**: exams, exam_scores
- **保留**: 学生和班级信息

### 🔧 维护工具 (选项17-20)

#### [17] 📋 查看详细日志
- **选项**:
  - 后端服务日志
  - 前端服务日志
  - 数据库服务日志
  - 所有服务日志
- **行数**: 最近50行

#### [18] 🔍 系统健康检查
- **检查项**:
  - 容器运行状态
  - 后端API响应
  - 前端服务状态
  - 数据库连接
- **结果**: ✅正常 / ❌异常

#### [19] 📦 重新构建服务
- **操作**: 无缓存重新构建Docker镜像
- **用途**: 代码更新后的完整重建
- **时间**: 需要几分钟

#### [20] 💻 进入后端容器
- **功能**: 进入backend容器shell
- **用途**: 手动执行命令、调试
- **退出**: 输入 `exit`

## 📝 使用场景

### 🆕 新系统部署
```
1. 选择 [1] 完整部署
2. 等待部署完成
3. 访问 http://localhost:5173
4. 使用 admin/123456 登录
```

### 🔄 日常维护
```
1. 选择 [2] 查看服务状态
2. 选择 [18] 系统健康检查
3. 如有异常，选择 [3] 重启服务
```

### 🧪 测试环境准备
```
1. 选择 [6] 重置数据库
2. 选择 [11] 导入Growth配置
3. 选择 [10] 导入标签配置
4. 选择 [9] 导入管理员账户
5. 选择 [12] 导入演示数据
```

### 🗑️ 数据清理
```
1. 选择 [15] 清除成长日志 (保留学生)
2. 或选择 [14] 清除学生数据 (完全清理)
3. 或选择 [5] 完全清理 (重置系统)
```

## ⚠️ 注意事项

### 🔴 危险操作
- **完全清理** (选项5): 删除所有数据
- **重置数据库** (选项6): 清空数据表
- **数据清理** (选项13-16): 不可恢复

### 💡 推荐流程
1. 新部署: 选择1
2. 更新代码: 选择19 → 3
3. 数据问题: 选择7 → 18
4. 性能调试: 选择17 → 20

### 🛡️ 安全提示
- 生产环境谨慎使用清理功能
- 重要数据请提前备份
- 确认操作前仔细阅读提示

## 🆘 故障排除

### 容器启动失败
```
1. 选择 [4] 停止服务
2. 选择 [19] 重新构建
3. 选择 [18] 健康检查
```

### 数据库连接错误
```
1. 选择 [2] 查看状态
2. 选择 [7] 运行迁移
3. 选择 [18] 健康检查
```

### 前端无法访问
```
1. 选择 [17] 查看日志 → 前端日志
2. 选择 [3] 重启服务
3. 检查 http://localhost:5173
```

## 📞 技术支持

如遇到问题，请提供：
1. 选择的操作选项
2. 错误截图
3. 系统健康检查结果
4. 相关服务日志

---
🎉 **享受使用Docker管理器！**