# 🐳 教育CRM系统 - 批处理脚本使用指南

## 📋 脚本概览

| 脚本文件 | 功能 | 适用场景 |
|---------|------|----------|
| `quick-start.bat` | 快速启动向导 | 新用户首次使用 |
| `deploy.bat` | 一键部署脚本 | 智能部署和重部署 |
| `setup-env.bat` | 环境配置向导 | 配置.env文件 |
| `docker-manager.bat` | 高级管理工具 | 系统维护和管理 |

## 🚀 快速开始

### 新用户推荐流程：
1. **双击运行** `quick-start.bat`
2. **选择** "一键部署"
3. **等待** 部署完成
4. **访问** http://你的IP:5173

## 📖 详细使用说明

### 1. 🌟 quick-start.bat - 快速启动向导
**用途**: 新用户入门，提供简化的操作选项

**功能**:
- 一键部署
- 环境配置
- 高级管理
- 查看帮助

**使用方法**:
```bash
# 直接双击运行
quick-start.bat
```

### 2. 🚀 deploy.bat - 一键部署脚本
**用途**: 智能部署系统，自动处理环境配置

**功能**:
- 自动检测.env文件
- 如果没有配置，自动启动配置向导
- 智能部署和服务启动
- 部署完成后显示访问地址

**使用方法**:
```bash
# 直接运行
deploy.bat

# 或通过其他脚本调用
```

**特点**:
- ✅ 智能检测Docker环境
- ✅ 自动获取公网IP
- ✅ 强制重建容器确保配置生效
- ✅ 部署后健康检查

### 3. ⚙️ setup-env.bat - 环境配置向导
**用途**: 配置.env环境文件，支持多种部署场景

**功能**:
- 本地开发环境配置
- 公网IP部署配置
- 域名部署配置
- 自定义配置

**使用方法**:
```bash
# 直接运行
setup-env.bat
```

**配置选项**:
1. **本地开发**: 自动配置localhost
2. **公网部署**: 自动检测或手动输入公网IP
3. **域名部署**: 支持HTTP/HTTPS域名配置
4. **自定义**: 完全自定义配置

**生成的.env文件包含**:
- API地址配置
- CORS跨域配置
- 数据库配置
- 安全配置

### 4. 🔧 docker-manager.bat - 高级管理工具 (v3.0)
**用途**: 系统的完整管理和维护

**新增功能**:
- 一键部署入口
- 环境配置向导入口
- 增强的错误处理
- Windows兼容性改进

**主要功能分类**:
- **快速操作**: 一键部署、环境配置、状态查看
- **高级管理**: 服务控制、数据清理
- **数据库管理**: 重置、迁移、管理界面
- **数据初始化**: 管理员、配置、演示数据
- **数据清理**: 分类清理各种数据
- **维护工具**: 日志查看、健康检查、重建服务

## 🌐 跨平台部署解决方案

### 问题解决：
✅ **解决公网访问认证问题**
- 自动配置CORS白名单
- 正确设置API基础地址
- 强制重建容器应用新配置

✅ **解决不同电脑部署问题**
- 自动检测公网IP
- 智能环境配置
- 标准化部署流程

✅ **解决Windows兼容性问题**
- 使用PowerShell替代curl
- 增强错误处理
- 友好的故障排除指导

## 🎯 常见使用场景

### 场景1: 首次部署
```bash
# 推荐方式
quick-start.bat → 选择"一键部署"

# 或分步骤
setup-env.bat → deploy.bat
```

### 场景2: 重新部署
```bash
# 使用现有配置
deploy.bat

# 或重新配置
setup-env.bat → deploy.bat
```

### 场景3: 更换服务器
```bash
# 在新服务器上
setup-env.bat → 输入新IP → deploy.bat
```

### 场景4: 维护管理
```bash
docker-manager.bat → 选择对应功能
```

## 🔍 故障排除

### 常见问题及解决方案：

**1. Docker未启动**
- 现象：提示Docker连接失败
- 解决：启动Docker Desktop，等待2-3分钟

**2. 端口被占用**
- 现象：容器启动失败
- 解决：检查3000、5173端口是否被占用

**3. 公网访问失败**
- 现象：本地能访问，公网不能
- 解决：运行`setup-env.bat`重新配置IP，然后`deploy.bat`重新部署

**4. 认证窗口问题**
- 现象：浏览器弹出认证对话框
- 解决：检查CORS配置，确保.env文件包含正确的域名/IP

## 📋 环境要求

- Windows 10/11
- Docker Desktop
- PowerShell 5.0+
- 网络连接（用于拉取镜像）

## 🎉 成功部署标志

当看到以下信息时，表示部署成功：
```
🎉 部署完成！
===============================================
📱 前端访问地址: http://你的IP:5173
🔗 后端API地址: http://你的IP:3000/api
🔑 默认管理员: admin / 123456
===============================================
```

## 📞 技术支持

如果遇到问题，请按以下顺序排查：
1. 检查Docker Desktop状态
2. 运行`docker-manager.bat` → 选择"系统健康检查"
3. 查看详细日志获取错误信息
4. 参考故障排除部分