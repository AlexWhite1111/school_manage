# æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

æœ¬é¡¹ç›®æä¾›äº†çµæ´»çš„æ•°æ®åº“åˆå§‹åŒ–æ–¹æ¡ˆï¼Œæ”¯æŒç”Ÿäº§ç¯å¢ƒå’Œå¼€å‘ç¯å¢ƒçš„ä¸åŒéœ€æ±‚ã€‚

## ğŸ—ï¸ åˆå§‹åŒ–æ–¹æ¡ˆè¯´æ˜

### 1. ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–
**é€‚ç”¨åœºæ™¯**: æ­£å¼éƒ¨ç½²çš„ç”Ÿäº§ç¯å¢ƒ
**ç‰¹ç‚¹**: 
- åªåˆ›å»ºå¿…éœ€çš„åŸºç¡€æ•°æ®
- ä¸åŒ…å«æµ‹è¯•æ•°æ®
- å®‰å…¨æ€§ä¼˜å…ˆ

**åŒ…å«å†…å®¹**:
- è¶…çº§ç®¡ç†å‘˜è´¦å· (`admin`)
- é¢„å®šä¹‰æ ‡ç­¾ç³»ç»Ÿ
- åŸºç¡€ç­çº§é…ç½®

### 2. å¼€å‘ç¯å¢ƒåˆå§‹åŒ–  
**é€‚ç”¨åœºæ™¯**: å¼€å‘ã€æµ‹è¯•ç¯å¢ƒ
**ç‰¹ç‚¹**:
- åŒ…å«å®Œæ•´çš„æ¨¡æ‹Ÿæ•°æ®
- ä¾¿äºåŠŸèƒ½æµ‹è¯•å’Œæ¼”ç¤º
- æ•°æ®ä¸°å¯Œå®Œæ•´

**åŒ…å«å†…å®¹**:
- æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒå†…å®¹
- æµ‹è¯•ç”¨æˆ·è´¦å· (`manager`, `teacher`)
- æ¨¡æ‹Ÿå®¢æˆ·å’Œå®¶é•¿æ•°æ® (100æ¡ï¼Œå¯é…ç½®)
- å­¦ç”Ÿæˆé•¿è®°å½•å’Œè€ƒå‹¤æ•°æ®
- è´¢åŠ¡è®¢å•å’Œä»˜æ¬¾è®°å½•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Windows ç”¨æˆ· (æ¨è)

#### ç”Ÿäº§ç¯å¢ƒ
```bash
# åŒå‡»è¿è¡Œ
db-init-production.bat
```

#### å¼€å‘ç¯å¢ƒ
```bash  
# åŒå‡»è¿è¡Œ
db-init-development.bat
```

#### ä»…è¿ç§»æ•°æ®åº“
```bash
# åŒå‡»è¿è¡Œ (ä¸é‡ç½®æ•°æ®ï¼Œä»…åº”ç”¨è¿ç§»)
db-migrate-only.bat
```

### å‘½ä»¤è¡Œç”¨æˆ·

#### ç”Ÿäº§ç¯å¢ƒ
```bash
cd backend

# æ–¹æ¡ˆ1: æ‰‹åŠ¨æ­¥éª¤
npm run prisma:migrate    # åº”ç”¨æ•°æ®åº“è¿ç§»
npm run db:init          # åˆå§‹åŒ–åŸºç¡€æ•°æ®

# æ–¹æ¡ˆ2: ä¸€é”®å‘½ä»¤
npm run db:setup
```

#### å¼€å‘ç¯å¢ƒ
```bash
cd backend

# æ–¹æ¡ˆ1: æ‰‹åŠ¨æ­¥éª¤  
npm run db:reset         # é‡ç½®æ•°æ®åº“
npm run db:seed-test     # ç”Ÿæˆæµ‹è¯•æ•°æ®

# æ–¹æ¡ˆ2: ä¸€é”®å‘½ä»¤
npm run db:setup-test

# è‡ªå®šä¹‰å®¢æˆ·æ•°é‡ (é»˜è®¤100ä¸ª)
TEST_CUSTOMER_COUNT=50 npm run db:seed-test
```

#### ä»…è¿ç§»
```bash
cd backend
npx prisma migrate deploy  # ç”Ÿäº§ç¯å¢ƒè¿ç§»
# æˆ–
npx prisma migrate dev     # å¼€å‘ç¯å¢ƒè¿ç§»
```

## ğŸ”§ å¯ç”¨å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ | é€‚ç”¨ç¯å¢ƒ |
|------|------|----------|
| `npm run db:init` | åˆå§‹åŒ–åŸºç¡€æ•°æ® | ç”Ÿäº§ |
| `npm run db:seed-test` | ç”Ÿæˆæµ‹è¯•æ•°æ® | å¼€å‘ |
| `npm run db:reset` | é‡ç½®æ•°æ®åº“ | å¼€å‘ |
| `npm run db:setup` | è¿ç§»+åŸºç¡€æ•°æ® | ç”Ÿäº§ |
| `npm run db:setup-test` | é‡ç½®+æµ‹è¯•æ•°æ® | å¼€å‘ |
| `npm run prisma:migrate` | å¼€å‘ç¯å¢ƒè¿ç§» | å¼€å‘ |

## ğŸ‘¤ é»˜è®¤è´¦å·

### ç”Ÿäº§ç¯å¢ƒ
- **è¶…çº§ç®¡ç†å‘˜**: `admin` / `123456`
  - âš ï¸ **é‡è¦**: é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç ï¼

### å¼€å‘ç¯å¢ƒ  
- **è¶…çº§ç®¡ç†å‘˜**: `admin` / `123456`
- **ç³»ç»Ÿç®¡ç†å‘˜**: `manager` / `123456`
- **æ•™å¸ˆè´¦å·**: `teacher` / `123456`
- **å­¦ç”Ÿè´¦å·**: ä½¿ç”¨12ä½å­¦å·ç™»å½• / `123456`
  - å­¦å·æ ¼å¼: `202508XXXXXX` (å¹´æœˆ+6ä½éšæœºæ•°)

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
backend/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init-db.ts          # åŸºç¡€æ•°æ®åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ seed-test-data.ts   # æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma       # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ seed.ts            # åŸå§‹ç§å­è„šæœ¬ (å·²åºŸå¼ƒ)
â”‚   â””â”€â”€ migrations/         # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â””â”€â”€ ...

# Bat è„šæœ¬ (é¡¹ç›®æ ¹ç›®å½•)
â”œâ”€â”€ db-init-production.bat   # ç”Ÿäº§ç¯å¢ƒåˆå§‹åŒ–
â”œâ”€â”€ db-init-development.bat  # å¼€å‘ç¯å¢ƒåˆå§‹åŒ–
â””â”€â”€ db-migrate-only.bat     # ä»…æ‰§è¡Œè¿ç§»
```

## âš™ï¸ ç¯å¢ƒé…ç½®

### ç¯å¢ƒå˜é‡

åœ¨ `backend/.env` æ–‡ä»¶ä¸­é…ç½®:

```env
# æ•°æ®åº“è¿æ¥
DATABASE_URL="postgresql://username:password@localhost:5432/database_name"

# æµ‹è¯•æ•°æ®é…ç½® (å¯é€‰)
TEST_CUSTOMER_COUNT=100  # ç”Ÿæˆçš„æµ‹è¯•å®¢æˆ·æ•°é‡
```

### æ•°æ®åº“è¦æ±‚

- PostgreSQL 12+ 
- æ•°æ®åº“ç”¨æˆ·éœ€è¦å®Œæ•´çš„è¯»å†™æƒé™
- ç¡®ä¿æ•°æ®åº“æœåŠ¡æ­£åœ¨è¿è¡Œ

## ğŸ”„ è¿ç§»å·¥ä½œæµ

### å¼€å‘è¿‡ç¨‹ä¸­ä¿®æ”¹Schema

1. ä¿®æ”¹ `prisma/schema.prisma`
2. è¿è¡Œè¿ç§»: `npm run prisma:migrate`
3. æ ¹æ®éœ€è¦é‡æ–°ç”Ÿæˆæµ‹è¯•æ•°æ®: `npm run db:seed-test`

### éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

1. éƒ¨ç½²ä»£ç åˆ°æœåŠ¡å™¨
2. é…ç½®ç”Ÿäº§ç¯å¢ƒ `.env`
3. è¿è¡Œ: `db-init-production.bat` æˆ– `npm run db:setup`
4. **ç«‹å³ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç **

## ğŸš¨ æ³¨æ„äº‹é¡¹

### ç”Ÿäº§ç¯å¢ƒ
- **å¿…é¡»ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç **
- å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“
- è°¨æ…ä½¿ç”¨é‡ç½®å‘½ä»¤

### å¼€å‘ç¯å¢ƒ
- `db:reset` ä¼š**å®Œå…¨æ¸…ç©º**æ•°æ®åº“
- æµ‹è¯•æ•°æ®ç”Ÿæˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´
- å¯é€šè¿‡ç¯å¢ƒå˜é‡æ§åˆ¶ç”Ÿæˆçš„æ•°æ®é‡

### è¿ç§»å®‰å…¨
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ `migrate deploy`
- å¼€å‘ç¯å¢ƒä½¿ç”¨ `migrate dev`
- è¿ç§»å‰å»ºè®®å¤‡ä»½é‡è¦æ•°æ®

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿ç§»å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®
   - ç¡®è®¤æ•°æ®åº“æœåŠ¡çŠ¶æ€
   - éªŒè¯ç”¨æˆ·æƒé™

2. **ç§å­æ•°æ®ç”Ÿæˆå¤±è´¥**
   - ç¡®ä¿è¿ç§»å·²æ­£ç¡®åº”ç”¨
   - æ£€æŸ¥TypeScriptç¼–è¯‘é”™è¯¯
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

3. **UUIDå­—æ®µé”™è¯¯**
   - ç¡®ä¿å·²åº”ç”¨æœ€æ–°è¿ç§»
   - é‡æ–°ç”ŸæˆPrisma Client: `npx prisma generate`

### è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜:
1. æŸ¥çœ‹æ§åˆ¶å°çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ `backend/.env` é…ç½®
3. ç¡®è®¤æ•°æ®åº“è¿æ¥çŠ¶æ€
4. è”ç³»å¼€å‘å›¢é˜Ÿ 