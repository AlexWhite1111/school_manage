# 客户看板 (CRM Dashboard) 详细交互流程

本文档详细描述了“客户看板”或称“CRM主界面”的页面布局、核心元素、以及所有相关的用户交互流程。

## 1. 页面核心元素

当用户进入此界面时，将看到一个采用“鱼骨状布局”的综合仪表盘。

*   **页面顶部 (固定)**
    1.  **数据看板 (Data Dashboard):** 以卡片形式实时展示核心指标。**调用 `GET /customers/stats` API**。
        *   总客户数 (`totalCustomers`)
        *   各阶段客户数 (`statusCounts` - POTENTIAL, INITIAL_CONTACT, INTERESTED, TRIAL_CLASS, ENROLLED, LOST)
        *   本月新增客户数 (`monthlyNewCustomers`)
    2.  **模糊搜索栏 (Fuzzy Search Bar):** 支持按 **客户姓名** 或 **学校** 进行实时模糊搜索。**调用 `GET /customers` API 的 `search` 参数**。
    3.  **全局操作按钮 (Global Action Buttons):**
        *   `导入数据 (CSV)` - **调用 `POST /import/customers` API**
        *   `导出数据 (CSV)` - **调用 `GET /export/customers` API**

*   **主内容区 (鱼骨布局)**
    1.  **左侧 - 筛选导航区 (Filter & Navigation)**
        *   一个纵向列表，作为筛选器。**调用 `GET /customers` API 的 `status` 参数**。
        *   固定选项包括 (对应 API 中的 `CustomerStatus` 枚举):
            *   `总客户` (默认选中, 不传 `status` 参数)
            *   `POTENTIAL` (潜在用户)
            *   `INITIAL_CONTACT` (初步沟通)
            *   `INTERESTED` (意向用户)
            *   `TRIAL_CLASS` (试课)
            *   `ENROLLED` (已报名)
            *   `LOST` (流失客户)
    2.  **右侧 - 客户列表区 (Client List Display)**
        *   根据左侧的选择，通过 **调用 `GET /customers` API** 动态展示对应的客户列表。
        *   列表顶部会显示当前筛选条件（如“意向用户 (INTERESTED)”）和该分类下的客户总数。
        *   列表的表头包含：`客户姓名`, `学校`, `年级`, `家长姓名`, `联系方式`, `来源渠道`, `客户状态`, `操作`。
        *   列表支持**批量选择**功能（每行前有复选框）。
        *   当有客户被选中时，列表顶部出现“批量删除”按钮。
        *   **支持自适应分页显示：** 客户列表区会根据屏幕宽度和高度动态调整每页显示的客户条目数，确保在不同设备和分辨率下都能获得最佳浏览体验。
        *   **分页导航栏：** 列表底部提供类似主流搜索引擎的分页导航（如“上一页/下一页”、“1 2 3 ... N”页码按钮），便于用户快速跳转和浏览多页客户数据。

## 2. 核心交互流程

### 2.1 查看与筛选客户

1.  **初始加载**
    *   **用户行为:** 用户首次进入该页面。
    *   **系统反馈:**
        *   左侧导航栏的“总客户”被默认选中并高亮。
        *   右侧列表区通过 **调用 `GET /customers`** 加载并展示所有阶段的客户信息。
        *   顶部数据看板通过 **调用 `GET /customers/stats`** 加载并显示最新统计数据。
        *   **边缘情况 (加载中):** 在数据完全加载前，数据看板和右侧列表区会显示加载动画（如骨架屏或旋转图标），防止用户看到空白或不完整的界面。
        *   **边缘情况 (无客户):** 如果系统中没有任何客户，右侧列表区会显示一个友好的空状态提示，例如：“暂无客户信息，请尝试导入或新建客户。”

2.  **按阶段筛选**
    *   **用户行为:** 用户点击左侧筛选导航栏中的任意一个阶段（如“意向用户 (INTERESTED)”）。
    *   **系统反馈:**
        *   被点击的阶段项高亮，其他项恢复正常。
        *   右侧客户列表区通过 **调用附带 `status` 查询参数的 `GET /customers` API** 刷新，仅显示属于“意向用户”阶段的客户。列表顶部的标题也更新为“意向用户 (INTERESTED)”。
        *   在数据刷新期间，列表区显示加载动画。

### 2.2 搜索客户

1.  **实时模糊搜索**
    *   **用户行为:** 用户在顶部的模糊搜索栏中输入关键字（客户姓名或学校）。
    *   **系统反馈:**
        *   系统无需用户点击“搜索”按钮，在用户输入停止后（例如延迟300毫秒）自动触发搜索。
        *   右侧客户列表根据当前**已选定**的阶段范围和关键字，通过 **调用 `GET /customers` API 并附带 `status` 和 `search` 参数** 进行实时过滤。
            *   **场景一:** 如果当前在“总客户”视图，则仅使用 `search` 参数进行搜索。
            *   **场景二:** 如果当前在“试课 (TRIAL_CLASS)”视图，则同时使用 `status=TRIAL_CLASS` 和 `search` 参数进行搜索。
        *   **边缘情况 (无结果):** 如果没有匹配的客户，列表区会显示提示：“在当前阶段未找到匹配的客户。”

2.  **清空搜索**
    *   **用户行为:** 用户清空搜索栏中的所有文字。
    *   **系统反馈:** 搜索过滤被清除，右侧客户列表恢复到清空前的状态（显示当前阶段的所有客户）。

### 2.3 客户操作

1.  **查看/编辑客户详情**
    *   **用户行为:** 用户点击某位客户所在行末尾的“查看/编辑”按钮。
    *   **系统反馈:** 页面跳转至该客户的“客户档案 (Lead Profile)”详情页。**此页面将通过 `GET /customers/:id` API 获取客户完整数据**。

2.  **快速变更状态 (例如：标记为流失)**
    *   **用户行为:** 用户点击某位客户所在行末尾的操作按钮，选择变更状态为“流失客户 (LOST)”。
    *   **系统反馈:**
        *   弹出一个确认对话框：“您确定要将客户 [客户姓名] 的状态变更为‘流失’吗？”
        *   用户确认后，系统 **调用 `PUT /customers/:id` API**，在请求体中传递 `{"status": "LOST"}`。
        *   成功后，该客户的条目会从当前阶段的列表中移除（除非当前正在查看“流失客户”列表）。
        *   顶部数据看板中的统计数据会相应更新。

### 2.4 批量操作

1.  **选择客户**
    *   **用户行为:** 用户点击列表每行前面的复选框，或点击表头的“全选”复选框。
    *   **系统反馈:**
        *   被选中的行高亮显示。
        *   列表顶部出现“已选择 X 位客户”的提示以及一个“批量删除”按钮。

2.  **批量删除**
    *   **用户行为:** 用户在选择了至少一位客户后，点击“批量删除”按钮。
    *   **系统反馈:**
        *   弹出一个警告对话框：“您确定要删除选中的 X 位客户吗？此操作不可恢复。”
        *   用户确认后，系统 **调用 `DELETE /customers` API**，请求体格式为 `{"ids": [1, 2, 3]}`，其中包含所有被选中客户的ID。
        *   列表刷新，被删除的客户消失。

### 2.5 数据导入/导出

1.  **导出数据**
    *   **用户行为:** 用户点击顶部的“导出数据 (CSV)”按钮。
    *   **系统反馈:**
        *   系统 **调用 `GET /export/customers` API**，并可选择性地附带上当前筛选所用的 `status` 或 `search` 查询参数。
        *   浏览器根据API返回的 `text/csv` 文件流触发下载操作。

2.  **导入数据**
    *   **用户行为:** 用户点击顶部的“导入数据 (CSV)”按钮。
    *   **系统反馈:**
        *   弹出一个文件上传窗口，可能包含CSV模板下载链接和格式说明。
        *   用户上传文件后，系统将文件通过 `multipart/form-data` 格式 **提交至 `POST /import/customers` API**，并根据返回的结果给出反馈（如“成功导入 X 条数据，失败 Y 条”）。

## 3. 边缘情况与系统反馈

*   **网络延迟/超时:**
    *   任何需要与后端服务器通信的操作（加载、筛选、搜索、删除等）都会在等待时显示加载指示器。
    *   如果请求超时，系统会显示一个全局错误提示，如“网络连接超时，请稍后重试”，并使相关按钮恢复可点击状态。
*   **并发操作:**
    *   当一个操作（如批量删除）正在进行时，应禁用其他相关操作按钮（如筛选、搜索、再次删除），防止数据状态冲突。 