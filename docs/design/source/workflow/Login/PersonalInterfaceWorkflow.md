# 个人界面与登出功能详细交互流程

本文档详细描述了用户通过点击头像，进入个人界面进行设置或执行登出操作的完整交互流程。

## 1. 访问入口：用户头像下拉菜单

1.  **触发操作**
    *   **用户行为:** 用户在登录状态下，点击页面右上角的用户头像。
    *   **系统反馈:**
        *   在用户头像下方，立即显示一个下拉菜单。
        *   菜单包含两个清晰的选项：
            *   `进入个人界面`
            *   `登出`

## 2. 功能一：登出 (Log Out)

1.  **执行登出**
    *   **用户行为:** 用户在下拉菜单中点击“登出”选项。
    *   **系统反馈:**
        *   系统 **调用 `POST /auth/logout` API**。
        *   系统立即清除前端存储的用户会话信息（如 Token）。
        *   页面强制跳转回应用的“登录”页面。
        *   （可选）在登录页面显示一个短暂的提示信息：“您已成功登出”。

## 3. 功能二：个人界面 (Personal Interface)

### 3.1 进入个人界面

1.  **用户行为:** 用户在下拉菜单中点击“进入个人界面”选项。
2.  **系统反馈:** 页面跳转至独立的“个人中心”或“账户设置”页面。**进入页面后，首先调用 `GET /users/me` API 获取当前用户信息并填充表单**。该页面包含以下功能模块：
    *   界面模式切换（黑夜/白天）
    *   修改用户信息
    *   修改密码

### 3.2 交互详述：界面模式切换

1.  **用户行为:** 用户点击“黑夜模式”或“白天模式”的切换开关（Toggle Switch）。
2.  **系统反馈:**
    *   界面主题立即在黑夜与白天模式之间切换，无延迟刷新。所有UI元素（背景、文字、按钮等）的颜色相应变化。
    *   用户的偏好设置被存储在浏览器本地（`localStorage`），以便下次访问时保持一致。

### 3.3 交互详述：修改用户名及辅助信息

1.  **用户行为:**
    *   用户在表单中修改 `username`, `email`, 或 `phone` 字段。
    *   用户点击“保存修改”按钮。
2.  **系统反馈:**
    *   “保存修改”按钮变为禁用状态，并显示加载指示器。
    *   **前端校验:** 检查输入是否为空或格式是否合规。若不合规，则在输入框下方提示错误，并终止提交。
    *   **后端处理:** **调用 `PUT /users/me` API**，请求体中包含被修改的字段。
        *   **成功:**
            *   按钮恢复正常，加载指示器消失。
            *   页面顶部显示成功提示：“信息更新成功！”。
            *   页面上的用户名（如右上角头像旁）应刷新为新用户名。
        *   **失败 (如网络错误):**
            *   按钮恢复正常。
            *   页面显示错误提示：“更新失败，请稍后重试”。

### 3.4 交互详述：修改密码

1.  **用户行为:**
    *   用户在对应输入框中分别键入“当前密码”(`oldPassword`)、“新密码”(`newPassword`)。
    *   用户点击“确认修改密码”按钮。
2.  **系统反馈:**
    *   “确认修改密码”按钮变为禁用状态并显示加载指示器。
    *   **前端校验:**
        *   检查所有输入框是否为空。
        *   (可选) 可增加“确认新密码”字段，并在前端校验两次输入是否一致。API本身不需要此字段。
        *   若校验失败，则提示明确的错误信息，并终止提交。
    *   **后端处理:** **调用 `PUT /users/me/password` API**，请求体为 `{"oldPassword": "...", "newPassword": "..."}`。
        *   **成功 (204 No Content):**
            *   系统更新密码。
            *   系统清除当前用户的登录凭证（Token）。
            *   前端强制跳转到“登录”页面。
            *   在登录页面顶部显示信息：“密码修改成功，请使用新密码重新登录。”
        *   **失败 (400 Bad Request):**
            *   按钮恢复正常。
            *   表单旁显示错误信息：“当前密码不正确，请重试。”
            *   为安全起见，所有密码输入框被清空。
        *   **失败 (网络或服务器错误):**
            *   按钮恢复正常。
            *   显示通用错误提示：“操作失败，请稍后重试。”

## 4. 边缘情况处理

*   **网络延迟/超时:**
    *   **用户行为:** 用户在提交修改（用户信息或密码）后，网络连接缓慢。
    *   **系统反馈:**
        *   加载指示器会持续显示。
        *   若设定了超时（例如10秒），系统会中断请求并显示全局错误提示：“请求超时，请检查您的网络连接。”
        *   提交按钮恢复可用状态。
*   **重复提交:**
    *   **系统行为:** 在任何提交操作（保存信息、修改密码）的等待期间，对应的提交按钮都应被禁用，以防止用户因不耐烦而重复点击，导致发送多个重复请求。 