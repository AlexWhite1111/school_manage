# 学生成长日志 (课后快速记录) 详细交互流程

本文档详细描述了“学生成长日志”模块中“课后快速记录”界面的所有元素、交互流程、弹出页面及系统反馈。

## 1. 页面核心布局与元素

界面采用“鱼骨状”布局，旨在实现高效操作。

*   **左侧 - 班级管理侧边栏 (Class Sidebar)**
    *   一个纵向列表，展示所有已创建的班级。**数据通过 `GET /classes` API 获取**。
    *   列表顶部有一个 **“+ 创建班级”** 的按钮。
    *   列表底部有一个固定的新分区入口：**“数据追踪报告”**。
    *   当前选中的班级或分区会被高亮显示。

*   **右侧 - 学生管理主区域 (Student Management Area)**
    *   **标题:** 显示当前选中班级的名称，例如 **“高一(A)班 - 学生列表”**。
    *   **学生列表:** 展示该班级下所有学生的卡片。**数据通过 `GET /classes/:id/students` API 获取**。每个学生卡片包含：
        *   学生姓名。
        *   一个 **“查看档案”** 的图标按钮。
        *   **智能考勤区:**
            *   `上午出勤`: 显示 `已到/迟到/请假/未到/--` 状态。**此状态来自 `GET /classes/:id/students` API 返回的当日考勤信息**。
            *   `下午出勤`: 显示 `已到/迟到/请假/未到/--` 状态。**同上**。
        *   四个状态按钮：`已到`, `迟到`, `请假`, `未到` (用于操作当前时段的考勤)。
    *   **悬浮按钮 (Floating Action Buttons):**
        *   右下角是一个 **“+” (添加学生)** 的主悬浮按钮。
        *   右下角还有一个 **“删除”** 按钮，用于激活批量删除模式。

## 2. 核心交互流程

### 2.1 班级管理 (侧边栏)

1.  **创建班级**
    *   **用户行为:** 用户点击侧边栏顶部的“+ 创建班级”按钮。
    *   **系统反馈:**
        *   弹出一个小窗口，包含一个文本输入框“班级名称”和一个“确认”按钮。
        *   用户输入名称并确认后，**调用 `POST /classes` API**。成功后，新班级立即出现在侧边栏列表中，并自动被选中、高亮。主区域标题随之更新。

2.  **选择班级**
    *   **用户行为:** 用户点击侧边栏中的任意一个班级名称。
    *   **系统反馈:**
        *   被点击的班级高亮。
        *   右侧主区域立即 **调用 `GET /classes/:id/students` API** 异步加载并显示该班级的学生列表。在加载完成前，显示骨架屏或加载动画。
        *   **边缘情况 (空班级):** 若该班级下无学生，主区域显示空状态提示：“当前班级暂无学生，请点击右下角‘+’按钮添加。”

### 2.2 学生管理 (主区域)

1.  **更新学生状态 (智能考勤)**
    *   **API 调用:** 前端UI根据时间（上午/下午）和用户点击的按钮（已到/迟到等），最终调用 `POST /attendance-records` API。
    *   **用户行为:** 用户点击某学生卡片上的任意一个状态按钮（如“迟到”）。
    *   **系统反馈:**
        *   系统 **调用 `POST /attendance-records` API**，请求体为 `{"enrollmentId": <student.enrollmentId>, "status": "LATE", "timeSlot": "AM"}` (status和timeSlot根据用户的操作和当前时间上下文决定)。
        *   API 调用成功后，卡片上的考勤状态立即更新。
        *   每日凌晨00:00，所有学生的考勤状态会自动重置为待记录状态(`--`)，以迎接新的一天。

2.  **添加学生到班级**
    *   **用户行为:** 用户点击右下角的“+”悬浮按钮。
    *   **系统反馈:**
        *   弹出一个 **“添加学生”** 的全屏或半屏窗口。
        *   **数据来源:** 该窗口通过调用 **`GET /api/customers?status=ENROLLED&unclassed=true`** API，来获取所有已报名但尚未加入任何班级的学员列表。
        *   窗口包含：
            *   顶部的 **模糊搜索框**，提示“按姓名搜索已报名的学员”。
            *   一个可滚动的 **“已报名学员列表”**，每行前有复选框。
            *   底部的“确认添加”和“取消”按钮。
        *   **交互:**
            *   用户可以通过搜索和筛选快速定位学生，然后勾选一个或多个学生。
            *   点击“确认添加”后，**调用 `POST /classes/:id/enrollments` API**，请求体为 `{"studentIds": [...]}`。窗口关闭，被选中的学生立即出现在主区域的学生列表中。

3.  **批量删除学生**
    *   **用户行为:** 用户点击右下角的“删除”按钮。
    *   **系统反馈:**
        *   系统进入“批量删除模式”。“删除”按钮变为红色，主区域每个学生卡片前出现复选框。
        *   用户勾选需要删除的学生。
        *   点击红色的“确认删除”按钮，系统弹出警告：“您确定要从本班级移除选中的X名学生吗？”
        *   确认后，**调用 `DELETE /enrollments` API**，请求体为 `{"enrollmentIds": [...]}`。学生被移除，列表刷新。

4.  **查看学生详细档案**
    *   **用户行为:** 用户点击学生卡片上的“查看档案”图标按钮。
    *   **系统反馈:** 页面跳转至该学生的详细信息页面。此页面 **调用 `GET /customers/:id`**，完全复用并关联“客户档案(Lead Profile)”，展示其所有基础信息、家庭画像和沟通纪要等。

### 2.3 学生个人成长记录 (核心功能)

1.  **展开标签视图**
    *   **用户行为:** 用户直接点击学生卡片的姓名区域（而非状态按钮）。
    *   **系统反馈:**
        *   该学生卡片在原位置 **向下展开**，平滑地展示出“词条图/标签”区域，不跳转页面。
        *   该区域分为两大部分：“正面标签”和“负面标签”。

2.  **添加标签 (实时保存)**
    *   **用户行为:** 用户在任意板块下点击一个预设标签，或在“自定义”输入框中输入新标签后按回车。
    *   **系统反馈:**
        *   **实时保存:** 每一次标签的添加都是一个 **独立的操作**。
        *   **获取标签:** 预设标签列表通过 **`GET /tags?type=GROWTH`** (假设有此类型) 获取。自定义标签通过 **`POST /tags`** 创建。
        *   **记录日志:** 当一个标签被选中或创建后，系统 **立即在后台调用 `POST /growth-logs` API** 保存该记录，请求体为 `{"enrollmentId": <student.enrollmentId>, "tagId": <tag.id>}`。
        *   **视觉反馈:**
            *   被点击的标签会被添加到一个显示区域，并附带上一个表示“刚刚添加”的视觉效果（如短暂高亮后消失）。
            *   如果网络延迟，标签旁可以显示一个微小的加载图标，成功后变为对勾，失败则变为感叹号，并提示“记录失败，请检查网络”。
    *   **预设标签完整列表 (无需手动添加):**
        *   **正面标签**: `演草工整`, `主动提问`, `按时完成作业`, `积极参与讨论`, `课前预习`, `作业整洁`, `主动帮助同学`, `[+] 自定义输入`
        *   **负面标签**: `作业拖拉`, `上课走神`, `作业不整洁`, `缺乏主动性`, `容易分心`, `不按时完成作业`, `课堂参与度低`, `依赖他人`, `情绪波动大`, `缺乏自信`, `[+] 自定义输入`

3.  **折叠标签视图**
    *   **用户行为:** 用户再次点击该学生的姓名区域，或点击一个卡片上出现的“收起”箭头。
    *   **系统反馈:** 展开的标签区域平滑地收起，恢复到初始卡片状态。

## 3. 边缘情况处理

*   **网络问题:** 由于标签添加是实时保存的，必须处理网络错误。如果单次添加失败，应给予用户明确的视觉反馈（如标签变红，出现重试按钮），而不影响用户继续为其他学生或其他项添加标签。
*   **数据加载:** 进入页面或切换班级时，主区域必须有加载状态，防止界面空白或闪烁。
*   **空状态:**
    *   首次使用，一个班级都没有时，应提示用户“请先创建您的第一个班级”。
    *   班级已创建但无学生时，提示用户添加学生。
    *   “添加学生”弹窗中，若所有已转化学员都已在本班，列表显示为空，并提示“所有学员均已添加”。

## 4. Feature 2.2: 个人成长报告 (Individual Progress Report)

### 4.1 入口与学生选择

1.  **进入数据追踪**
    *   **用户行为:** 用户点击左侧侧边栏底部的 **“数据追踪报告”** 分区。
    *   **系统反馈:**
        *   “数据追踪报告”分区被高亮。
        *   右侧主区域刷新，标题变为 **“数据追踪 - 学生列表”**。
        *   主区域通过调用 **`GET /api/customers?status=ENROLLED`** API，展示一个包含所有已报名学生的列表。
        *   在列表顶部，提供一个 **“导出成长记录 (CSV)”** 按钮。
        *   **边缘情况 (无学生):** 若整个系统没有任何学生，则显示空状态提示：“系统中暂无学生，请先去创建班级并添加学生。”

2.  **选择学生**
    *   **用户行为:** 用户在“数据追踪 - 学生列表”中点击任意一个学生姓名。
    *   **系统反馈:**
        *   页面跳转至该学生的专属 **“个人成长报告”** 页面，**并通过 `GET /students/:id/report` API 获取报告所需数据**。

### 4.2 个人成长报告页面元素与交互

页面标题为 **“个人成长报告 - [学生姓名]”**，包含以下四个可交互的数据可视化模块。**所有模块数据均来自 `GET /students/:id/report` API**。

1.  **模块一：词条云图 (Tag Cloud)**
    *   **默认展示:** 默认显示最近7天所有标签（正面+负面）生成的词条云图。
    *   **交互 - 时间段筛选:**
        *   **用户行为:** 用户点击模块右上角的 `7天` 或 `15天` 按钮，或点击“自定义”来选择日期范围。
        *   **系统反馈:** **重新调用 `GET /students/:id/report` API**，并附带 `startDate` 和 `endDate` 查询参数。词条云图根据返回的新数据重新渲染。加载期间显示动画。
        *   **边缘情况 (无数据):** 若所选时段内无任何标签记录，则显示提示：“该时段内无标签数据。”

2.  **模块二：正面词条Top榜 (Top Positive Tags)**
    *   **默认展示:** 默认以列表或条形图形式，展示最近7天内被记录次数最多的正面词条 Top 5。
    *   **交互 - 时间段筛选:**
        *   **用户行为:** 与词条云图类似，用户可点击 `7天` / `15天` / `自定义` 按钮进行切换。
        *   **系统反馈:** **重新调用 `GET /students/:id/report` API** 并附带时间参数，榜单根据新时间范围刷新。加载期间显示动画。
        *   **边缘情况 (无数据):** 若所选时段内无正面标签记录，则显示提示：“该时段内无正面标签数据。”

3.  **模块三：负面词条Top榜 (Top Negative Tags)**
    *   **默认展示:** 默认展示最近7天内被记录次数最多的负面词条 Top 5。
    *   **交互 - 时间段筛选:**
        *   **用户行为:** 与词条云图类似，用户可点击 `7天` / `15天` / `自定义` 按钮进行切换。
        *   **系统反馈:** **重新调用 `GET /students/:id/report` API** 并附带时间参数，榜单根据新时间范围刷新。加载期间显示动画。
        *   **边缘情况 (无数据):** 若所选时段内无负面标签记录，则显示提示：“该时段内无负面标签数据。”

4.  **模块四：成长趋势曲线图 (Growth Trend Chart)**
    *   **默认展示:** 默认显示最近7天内，正面和负面标签数量随日期变化的平滑曲线图（两条线）。
    *   **交互 - 曲线筛选:**
        *   **用户行为:** 用户点击模块右上角的 `正面`、`负面` 或 `全部` 按钮。
        *   **系统反馈:** 图表中显示的曲线随之变化（显示正面曲线、负面曲线，或两条都显示）。
    *   **交互 - 时间段筛选:**
        *   **用户行为:** 用户点击 `7天` / `15天` / `自定义` 按钮进行切换。
        *   **系统反馈:** **重新调用 `GET /students/:id/report` API** 并附带时间参数，整个图表根据新时间范围刷新数据和坐标轴。加载期间显示动画。
        *   **边缘情况 (无数据):** 若所选时段内无任何标签记录，则显示一个空的坐标系和提示：“该时段内无标签数据。” 